#!/usr/bin/env bash

lvl=1 #or 3 or 5

if [ ${lvl}==1 ]
then
  # NIST lvl 1 input to create_ideals.sage
  P=23920667128620486487914848107166358953830561597426178123910317653495243603967
  NI=1809251394333065553493296640760748560207343510400633813116524750123642650624
  NU=1852673427797059126777135760139006525652319754650249024631321344126610074238975
  LN=100
  NL=30 #37
  BTSTART=3
  BTEND=20
  LTSTART=5
  LTEND=12
elif [ ${lvl}==2 ]
then
  # NIST lvl 3 input to create_ideals.sage
  P=596076388303301563275968567721546557313301041076583731790360080103537153788990265547963593275457141924327935967231
  NI=76957043352332967211482500195592995713046365762627825523336510555167425334955489475418488779072100860950445293568
  NU=78804012392788958424558080200287227610159478540930893335896586808491443542994421222828532509769831281613255980613631
  LN=100
  NL=28 #55
  BTSTART=3
  BTEND=20
  LTSTART=5
  LTEND=12
else
  # NIST lvl 5 input to create_ideals.sage
  P=7641062277188190931257858961118086084398023383691680367903524362155121193772173035828287754135603947650769328156078431040012246037867542351098425638911
  NI=818347651974035467503297424206899788054160511510766197370822842024033449101168638720817523081476039287721671031890017752304314136471348263332131897344
  NU=837987995621412318723376562387865382967460363787024586107722590232610251879596686050117143635431464230626991136655378178359617675746660621652103062880255
  LN=100
  NL=37 #72
  BTSTART=3
  BTEND=20
  LTSTART=5
  LTEND=12
fi

echo "Run quality tests on NIST lvl${lvl} ${LN} ideals with p=${P}  nl=${NL}"

DATAFILE="lvl${lvl}_ln${LN}_nl${NL}"
echo "Generating ideals into the file ${DATAFILE}"
sage create_ideals.sage $P $NI $NU $LN $NL $BTSTART $LTSTART -data datafile=$DATAFILE


for BT in `seq $BTSTART 1 $BTEND`
do
  for LT in `seq $LTSTART 1 $LTEND`
  do
    #create a new bkz_constants.h
    python bkz_constants.py $BT $LT

    #filename to re-direct output of the tests to
    FILENAME="lvl${lvl}_p239_nl${NL}_bt${BT}_lt${LT}"
    echo "redirecting output to file ${FILENAME}"

    make quality_test
    ./build/quality_test > $FILENAME 2>&1

  done
done





